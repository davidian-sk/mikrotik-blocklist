# **🛡️ Davidian-SK MikroTik Blocklist Aggregator**

This repository provides a self-updating, high-performance MikroTik Address List generated by aggregating multiple public threat intelligence feeds. The core goal is to generate the mathematically **most compact set of CIDR ranges** possible, minimizing clutter and maximizing firewall efficiency.

## **🚀 Features**

* **Source Aggregation:** Pulls IP data from various public threat feeds (sources.txt).  
* **Optimal Compression:** Uses the Python ipaddress library to aggregate thousands of individual IPs and ranges (like /22, /17) into the **minimal list of CIDR blocks**.  
* **High Performance:** Generates a RouterOS script (blacklist.rsc) designed for import into the **raw** firewall table.  
* **Dual Automation:** Includes two scripts for flexible deployment (local host or GitHub-driven).

## **📝 Output Files**

The Linux script generates the following files:

| File Name | Content | Purpose |
| :---- | :---- | :---- |
| **blacklist.rsc** | RouterOS script for import. | **Essential:** This is what the MikroTik downloads and runs. |
| **aggregated\_cidr\_ranges.txt** | List of final, optimized IP/CIDR ranges (e.g., 1.2.3.0/24). | **Essential:** Used for direct audit or consumption by other tools. |
| **aggregated\_ips.txt** | List of unique, non-compressed IPs/Ranges. | **Audit Log:** Used for debugging and tracing false positives. |
| **ip\_aggregator\_git.sh** | The script that generated the files. | **Source Control:** Tracks the logic used for the push. |
| **sources.txt** | List of all input URLs. | **Configuration:** Tracks the source feeds used. |

## **🛠️ Automation Setup**

This setup assumes the script runs on a Linux host (e.g., **Raspberry Pi** or **Garuda Linux** on an Intel NUC) and the MikroTik fetches the result from this repository.

### **1\. Host Setup (Linux Cron Job)**

Choose one of the two aggregator scripts to run based on your needs:

| Script Name | Use Case | Frequency |
| :---- | :---- | :---- |
| **ip\_aggregator\_local.sh** | **Daily Runs** (Fastest local update). | Recommended: **Daily** (e.g., 03:00) |
| **ip\_aggregator\_git.sh** | **GitHub Push** (For public repository updates). | Recommended: **Weekly** (e.g., Sunday @ 03:00) |

To run the script daily using cron (e.g., for the local version):

\# Edit the cron schedule  
crontab \-e

\# Add this line to run the script every day at 3:00 AM (Ensure path is correct\!)  
0 3 \* \* \* /path/to/project/ip\_aggregator\_local.sh

### **2\. MikroTik RouterOS Scheduler (Foolproof Setup)**

Use the following commands on your **MikroTik RouterOS** device to set up the automated weekly download and import. This includes necessary logging and checks for reliability.

**Note:** The URL below points to the main branch of your repository and uses your defined list name, davidian-sk-blocklist.

/system script  
\# Script to download the latest blocklist from GitHub  
add name="davidian-sk-blacklist-dl" source={  
    :log info "Starting threat feed download from GitHub."  
    /tool fetch url="\[https://raw.githubusercontent.com/davidian-sk/mikrotik-blocklist/main/blacklist.rsc\](https://raw.githubusercontent.com/davidian-sk/mikrotik-blocklist/main/blacklist.rsc)" mode=https dst-path=blacklist.rsc verify-certificate=yes  
      
    :if (\[:len \[/file find name="blacklist.rsc"\]\] \> 0\) do={  
        :log info "File downloaded successfully. Running import script."  
        /system script run davidian-sk-blacklist-replace  
    } else={  
        :log error "File download failed. Skipping import."  
    }  
}

\# Script to remove the old list and import the new data  
add name="davidian-sk-blacklist-replace" source={  
    :log info "Importing new threat feed and cleaning old list."  
      
    \# 1\. Clean the Address List before importing new data (essential cleanup step)  
    /ip firewall address-list remove \[find where list="davidian-sk-blocklist"\];   
      
    \# 2\. Import the new list  
    /import file-name=blacklist.rsc;   
      
    \# 3\. Clean up the file  
    /file remove blacklist.rsc  
    :log info "Threat list imported and files cleaned."  
}

/system scheduler  
\# Schedule the download and import process to run once a week  
add interval=7d name="dl-ins-mt-blacklist" start-time=00:05:00 on-event=davidian-sk-blacklist-dl

### **3\. Final Firewall Rule (Performance)**

To activate the blocklist, add a single, high-priority rule to your **/ip firewall raw** table. This ensures traffic is dropped immediately, bypassing connection tracking for optimal router performance.

\# Check your chain (prerouting is best for simple blocking)  
/ip firewall raw add action=drop chain=prerouting src-address-list=davidian-sk-blocklist comment="DROP Automated Threat List (RAW)"  
